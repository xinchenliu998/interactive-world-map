<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>äº¤äº’å¼ä¸–ç•Œåœ°å›¾</title>

  <!-- Leaflet åœ°å›¾åº“ -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- è‡ªå®šä¹‰æ ·å¼ -->
  <link rel="stylesheet" href="styles.css" />

  <!-- é…ç½®æ¨¡å—ï¼ˆå¿…é¡»åœ¨å…¶ä»–æ¨¡å—ä¹‹å‰åŠ è½½ï¼‰-->
  <script src="js/config.js"></script>

  <!-- æ•°æ®æ¨¡å— -->
  <script src="data/country-names.js"></script>
  <script src="data/manual-countries.js"></script>
  <script src="data/country-codes.js"></script>

  <!-- åŠŸèƒ½æ¨¡å— -->
  <script src="js/map.js"></script>
  <script src="js/countries.js"></script>
  <script src="js/small-countries.js"></script>
  <script src="js/search.js"></script>

  <!-- åº”ç”¨åˆå§‹åŒ– -->
  <script>
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
    document.addEventListener("DOMContentLoaded", async function () {
      // ä»é…ç½®è·å– UI æ–‡æœ¬
      const uiConfig = getAll().ui || {};
      const mapConfig = getAll().map || {};

      // è®¾ç½®é¡µé¢æ ‡é¢˜
      if (uiConfig.title) {
        document.title = uiConfig.title;
      }

      // æ›´æ–°æœç´¢æ¡†å ä½ç¬¦
      const searchInput = document.getElementById("searchInput");
      if (searchInput && uiConfig.searchPlaceholder) {
        searchInput.placeholder = uiConfig.searchPlaceholder;
      }

      // æ›´æ–°æœç´¢æŒ‰é’®æ–‡æœ¬
      const searchButton = document.getElementById("searchButton");
      if (searchButton && uiConfig.searchButtonText) {
        searchButton.textContent = `ğŸ” ${uiConfig.searchButtonText}`;
      }

      // æ›´æ–°é»˜è®¤é€‰ä¸­å›½å®¶æ–‡æœ¬
      const currentCountry = document.getElementById("currentCountry");
      if (currentCountry && uiConfig.currentCountryDefaultText) {
        currentCountry.textContent = uiConfig.currentCountryDefaultText;
      }

      // æ›´æ–°æ“ä½œè¯´æ˜
      const infoBoxInstructions = document.querySelector("#infoBox p:nth-of-type(2)");
      if (infoBoxInstructions && uiConfig.infoBoxInstructions) {
        infoBoxInstructions.innerHTML = `<strong>æ“ä½œè¯´æ˜ï¼š</strong> ${uiConfig.infoBoxInstructions}`;
      }

      // æ›´æ–°æç¤ºæ–‡æœ¬
      const infoBoxTip = document.querySelector("#infoBox p:nth-of-type(3)");
      if (infoBoxTip && uiConfig.infoBoxTip) {
        infoBoxTip.innerHTML = `<strong>æç¤ºï¼š</strong> ${uiConfig.infoBoxTip}`;
      }

      // åˆå§‹åŒ–åœ°å›¾
      initMap();

      // åŠ è½½å›½å®¶è¾¹ç•Œæ•°æ®
      loadCountryData(
        // æˆåŠŸå›è°ƒ
        function (countriesLayer, worldGeoJSON) {
          // ä¸ºå°å›½å®¶æ·»åŠ å¯ç‚¹å‡»çš„åœ†å½¢æ ‡è®°
          addSmallCountryMarkers(countriesLayer);

          // æ˜¾ç¤ºæ‰‹åŠ¨å®šä¹‰çš„å›½å®¶æ ‡è®°
          showManualCountryMarkers();

          // è®¾ç½®æœç´¢åŠŸèƒ½
          setupSearchEvents();
        },
        // é”™è¯¯å›è°ƒ
        function (error) {
          console.error("æ•°æ®åŠ è½½å¤±è´¥:", error);
        }
      );
    });
  </script>
</head>
<body>
  <div id="container">
    <h1>ğŸŒ äº¤äº’å¼ä¸–ç•Œåœ°å›¾</h1>
    <p class="subtitle">
      ç‚¹å‡»åœ°å›¾ä¸Šçš„ä»»æ„å›½å®¶/åœ°åŒºï¼Œå…¶è¾¹ç•Œå°†é«˜äº®æ˜¾ç¤ºï¼Œåœ°å›¾ä¼šè‡ªåŠ¨å®šä½åˆ°è¯¥ä½ç½®ã€‚
    </p>

    <div id="searchBox">
      <input
        type="text"
        id="searchInput"
        placeholder="è¾“å…¥åŸå¸‚æˆ–å›½å®¶åç§°ï¼ˆæ”¯æŒä¸­æ–‡/è‹±æ–‡ï¼‰ï¼ŒæŒ‰å›è½¦æœç´¢..."
      />
      <button id="searchButton">ğŸ” æœç´¢</button>
    </div>
    <div id="searchResults"></div>

    <div id="map"></div>

    <div id="infoBox">
      <h3>ğŸ—ºï¸ åœ°å›¾ä¿¡æ¯</h3>
      <p>
        <strong id="selectedTypeLabel">å½“å‰é€‰ä¸­ï¼š</strong>
        <span id="currentCountry">æš‚æ— ï¼Œè¯·ç‚¹å‡»åœ°å›¾é€‰æ‹©</span>
      </p>
      <p>
        <strong>æ“ä½œè¯´æ˜ï¼š</strong> é¼ æ ‡æ‚¬åœå¯é¢„è§ˆï¼Œç‚¹å‡»åå˜ä¸º<span
          style="color: #e74c3c"
          >çº¢è‰²é«˜äº®</span
        >ã€‚
      </p>
      <p><strong>æç¤ºï¼š</strong> åŠ è½½è¾¹ç•Œæ•°æ®å¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼Œè¯·ç¨å€™ã€‚</p>
    </div>

    <p class="credits">ä½¿ç”¨ Leaflet åº“æ¸²æŸ“ | æœ¬ç¤ºä¾‹ä¸ºäº¤äº’å¼åœ°å›¾æ¼”ç¤º</p>
  </div>
</body>
</html>
